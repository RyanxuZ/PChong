<!-- HTML generated by Yang Ye --><div style="background: #ffffff; overflow:auto;width:auto;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span></span><span style="color: #888888">// LeetCode, Surrounded Regions</span>
<span style="color: #888888">// BFS method</span>
<span style="color: #888888">// Complexity:</span>
<span style="color: #888888">//     O(n) time, O(n) space</span>

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Solution</span> {
<span style="color: #008800; font-weight: bold">public</span><span style="color: #333333">:</span>
    <span style="color: #333399; font-weight: bold">void</span> solve(vector<span style="color: #333333">&lt;</span>vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">char</span><span style="color: #333333">&gt;&gt;</span> <span style="color: #333333">&amp;</span>board) {
        <span style="color: #008800; font-weight: bold">if</span> (board.empty()) <span style="color: #008800; font-weight: bold">return</span>;
        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> m <span style="color: #333333">=</span> board.size();
        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> board[<span style="color: #0000DD; font-weight: bold">0</span>].size();

        <span style="color: #888888">// do BFS from up and down boundary</span>
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; i <span style="color: #333333">&lt;</span> n; i<span style="color: #333333">++</span>) {
            bfs(board, <span style="color: #0000DD; font-weight: bold">0</span>, i);
            bfs(board, m <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>, i);
        }

        <span style="color: #888888">// do BFS from left and right boundary</span>
        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> j <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>; j <span style="color: #333333">&lt;</span> m <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>; j<span style="color: #333333">++</span>) {
            bfs(board, j, <span style="color: #0000DD; font-weight: bold">0</span>);
            bfs(board, j, n <span style="color: #333333">-</span> <span style="color: #0000DD; font-weight: bold">1</span>);
        }

        <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> i <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; i <span style="color: #333333">&lt;</span> m; i<span style="color: #333333">++</span>)
        	<span style="color: #008800; font-weight: bold">for</span> (<span style="color: #333399; font-weight: bold">int</span> j <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>; j <span style="color: #333333">&lt;</span> n; j<span style="color: #333333">++</span>)
        		<span style="color: #888888">// mark the BFS-unvisited node with &#39;X&#39;</span>
			    <span style="color: #008800; font-weight: bold">if</span> (board[i][j] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;O&#39;</span>)
			        board[i][j] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;X&#39;</span>;
			    <span style="color: #888888">// mark the BFS-visited node with &#39;O&#39; </span>
			    <span style="color: #008800; font-weight: bold">else</span> <span style="color: #0066BB; font-weight: bold">if</span> (board[i][j] <span style="color: #333333">==</span> <span style="color: #0044DD">&#39;+&#39;</span>)
			        board[i][j] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;O&#39;</span>;
	} 

<span style="color: #008800; font-weight: bold">private</span><span style="color: #333333">:</span>
	<span style="color: #333399; font-weight: bold">void</span> bfs(vector<span style="color: #333333">&lt;</span>vector<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">char</span><span style="color: #333333">&gt;&gt;</span> <span style="color: #333333">&amp;</span>board, <span style="color: #333399; font-weight: bold">int</span> i, <span style="color: #333399; font-weight: bold">int</span> j) {
	    <span style="color: #008800; font-weight: bold">typedef</span> pair<span style="color: #333333">&lt;</span><span style="color: #333399; font-weight: bold">int</span>, <span style="color: #333399; font-weight: bold">int</span><span style="color: #333333">&gt;</span> state_t;
	    queue<span style="color: #333333">&lt;</span>state_t<span style="color: #333333">&gt;</span> q;
	    <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> m <span style="color: #333333">=</span> board.size();
	    <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> n <span style="color: #333333">=</span> board[<span style="color: #0000DD; font-weight: bold">0</span>].size();

	    <span style="color: #008800; font-weight: bold">auto</span> is_valid <span style="color: #333333">=</span> [<span style="color: #333333">&amp;</span>](<span style="color: #008800; font-weight: bold">const</span> state_t <span style="color: #333333">&amp;</span>s) {
	        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> x <span style="color: #333333">=</span> s.first;
	        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> y <span style="color: #333333">=</span> s.second;
	        <span style="color: #008800; font-weight: bold">if</span> (x <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">||</span> x <span style="color: #333333">&gt;=</span> m <span style="color: #333333">||</span> y <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">0</span> <span style="color: #333333">||</span> y <span style="color: #333333">&gt;=</span> n <span style="color: #333333">||</span> board[x][y] <span style="color: #333333">!=</span> <span style="color: #0044DD">&#39;O&#39;</span>)
	            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">false</span>;
	        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">true</span>;
	    };

	    <span style="color: #008800; font-weight: bold">auto</span> state_extend <span style="color: #333333">=</span> [<span style="color: #333333">&amp;</span>](<span style="color: #008800; font-weight: bold">const</span> state_t <span style="color: #333333">&amp;</span>s) {
	        vector<span style="color: #333333">&lt;</span>state_t<span style="color: #333333">&gt;</span> result;
	        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> x <span style="color: #333333">=</span> s.first;
	        <span style="color: #008800; font-weight: bold">const</span> <span style="color: #333399; font-weight: bold">int</span> y <span style="color: #333333">=</span> s.second;
	        <span style="color: #008800; font-weight: bold">const</span> state_t new_states[<span style="color: #0000DD; font-weight: bold">4</span>] <span style="color: #333333">=</span> {{x<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>,y}, {x<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>,y},{x,y<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>}, {x,y<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>}};
	        <span style="color: #008800; font-weight: bold">for</span>(<span style="color: #333399; font-weight: bold">int</span> k<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>;k<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">4</span>; <span style="color: #333333">++</span>k){
	        	<span style="color: #008800; font-weight: bold">if</span> (is_valid(new_states[k])) {
	        		<span style="color: #888888">// mark</span>
	        		board[new_states[k].first][new_states[k].second] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;+&#39;</span>;
	        		result.push_back(new_states[k]);
	        	} 
	        }
	        <span style="color: #008800; font-weight: bold">return</span> result;
	    };
        
        state_t start <span style="color: #333333">=</span> { i, j };
        <span style="color: #008800; font-weight: bold">if</span> (is_valid(start)) {
            board[i][j] <span style="color: #333333">=</span> <span style="color: #0044DD">&#39;+&#39;</span>;
            q.push(start);
        }
        
        <span style="color: #008800; font-weight: bold">while</span> (<span style="color: #333333">!</span>q.empty()) {
            <span style="color: #008800; font-weight: bold">auto</span> cur <span style="color: #333333">=</span> q.front();
            q.pop();
            <span style="color: #008800; font-weight: bold">auto</span> new_states <span style="color: #333333">=</span> state_extend(cur);
            <span style="color: #008800; font-weight: bold">for</span> (<span style="color: #008800; font-weight: bold">auto</span> <span style="color: #997700; font-weight: bold">s</span> : new_states) q.push(s);
        } 
    }
};
</pre></div>
